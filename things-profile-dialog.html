<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../things-global-behavior/things-global-behavior.html">
<link rel="import" href="../things-auth/things-change-password.html">

<!--
  `<things-profile-dialog>` 사용자 프로파일 

  Example

    <things-profile-dialog 
      name="elidom" 
      email="elidom@example.com" 
      img="../../images/profile.png">
    </things-profile-dialog>

@demo demo/index.html
-->

<dom-module id="things-profile-dialog">
  <template>
    <style>
      :host {
        display: inline-flex;
        @apply(--things-profile-dialog);
      }
      paper-card {
        min-width:250px;
      }
      paper-card::shadow .header {
        background-color:var(--paper-blue-grey-400);
      }
      paper-card::shadow .title-text {
        padding:15px 0 70px 0 !important;
        color:#fff !important;
        text-align:center;
      }
      img {
        @apply(--things-profile-img);
      }
      .close {
        background-color:transparent;
        position:absolute;
        opacity:.5;
        top:5px;
        right:5px;
        border:none;
        padding:0;
        color:#fff;
      }
      .logout {
        @apply(--things-profile-logout);
      }
      .logout iron-icon {
        @apply(--things-icon);
      }
      .user {
        margin-top:60px;
        color:var(--things-primary-text-color);
        text-align:center;
        font-size:13px;
      }
      .user strong {
        display:block;
        font-size:15px;
      }
      paper-button {
        @apply(--things-button-important);
        @apply(--things-default-margin);
        width:89%;
      }
      button:focus {
        outline:none
      }
    </style>

    <paper-card heading="X-MES">
      <button on-tap="closeProfile" class="close"><iron-icon icon="icons:cancel"></iron-icon></button>
      <img src="[[img]]">
      <button on-tap="logout" class="logout"><iron-icon icon="icons:exit-to-app"></iron-icon></button>

      <div id="info">
        <content>
          <div class="user">
            <strong>[[globals.user.name]]</strong>
            [[globals.user.email]]
          </div>

          <paper-button 
            raised color="green"
            on-click="showChangePasswordScreen">
            <things-i18n-msg msgid="button.change_password" auto>Change Password</things-i18n-msg>
          </paper-button>

          <things-logout 
            id="logout" 
            action="logout"
            logout-path="logout"
            icon="icons:exit-to-app"
            hidden>
          </things-logout>
        </content>
      </div>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'things-profile-dialog',

      properties : {
        img : {
          type: String,
          value: '../../images/profile.png'
        }
      },

      behaviors: [ 
        Things.GlobalBehavior,
        Polymer.PaperDialogBehavior 
      ],

      /**
       * Logout
       */
      logout: function(event) {
         this.$.logout.logout(); 
         this.closeProfile();
      },

      /**
       * Show Change Password Screen
       */
      showChangePasswordScreen: function(event) {
        var element = document.createElement('things-change-password');
        element.title = 'Change Password';
        var dialog = app.$['common-full-dialog'];
        element.actionUrl = 'users/change_pass/' + this.globals.user.id;
        element.method = 'POST';
        element.currentUserInfo = this.globals.user;

        var me = this;
        element.addEventListener("things-change-password-success", function(event) {
          dialog.closeBasicDialog();
          me.logout();
        });

        element.addEventListener("things-change-password-failure", function(event) {
          var response = event.detail.request.xhr.response;
          this.openResponseError(response);
        });

        dialog.openBasicDialog(element, true, null);
      },

      /**
       * Close Profile Screen
       */
      closeProfile: function(event) {
        this.close();
      }

    });
  </script>

</dom-module>