<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../things-global-behavior/things-global-behavior.html">
<link rel="import" href="../things-i18n-msg/things-i18n-msg.html">

<link rel="import" href="./things-profile-dialog.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<!--
## things-profile
  `<things-profile-dialog>`  프로파일 컴포넌트

  Example

      <things-profile></things-profile>

@demo demo/index.html
-->

<dom-module id="things-profile">
	<template>
		<style>
			:host {
				display: inline-block;
				background-color: var(--things-secondary-background-color);

			}

			paper-icon-button {
				@apply(--things-small-icon);
				margin-right: 3px;
			}
		</style>

		<things-i18n-msg msgid="button.profile" msg="{{labelProfile}}" auto hidden>profile</things-i18n-msg>
		<paper-icon-button id="account"
											 icon="icons:account-circle"

											 title="[[labelProfile]]"
											 on-tap="open">
		</paper-icon-button>
		{{globals.user.name}}

		<things-profile-dialog id="dialog"
													 system="[[system]]"
													 role-list-url="[[roleListUrl]]"
													 role-request-url="[[roleRequestUrl]]"
													 ></things-profile-dialog>

		<iron-localstorage name="setting.locale"
											 value="{{globals.locale}}"
											 on-iron-localstorage-load-empty="onLocaleEmpty">
		</iron-localstorage>
	</template>

	<script>
		Polymer({
			is: 'things-profile',

			properties: {
				/**
				 * 버튼 활성화 여부
				 */
				buttonEnable: {
					type: Boolean,
					computed: '_isSignedIn(globals.user.name)'
				},

				/**
				 * 시스템 명
				 */
				system: {
					type: String
				},

				/**
				 * 권한 요청 URL
				 */
				roleRequestUrl: {
					type: String,
					value: 'request_auths/account/auth/request'
				},

				/**
				 * 역할 리스트 조회 URL
				 */
				roleListUrl: {
					type: String
				}
			},

			behaviors: [
				Things.GlobalBehavior
			],

			/**
			 * Profile Dialog를 오픈한다.
			 */
			open: function() {
				this.$.dialog.open()
			},

			/**
			 * 로그인 된 상황인 지 체크
			 * @param {String} name name을 체크하여 로인인 체크
			 */
			_isSignedIn: function(name) {
				return name ? false : true;
			},

			/**
			 * Locale 설정이 안 된 경우 - 기본 로케일로 설정
			 */
			onLocaleEmpty: function() {
				this.set('globals.locale', this.defaultLocale);
			}
		});
	</script>
</dom-module>
